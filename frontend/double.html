<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Double Bracket Overlay</title>
<style>
  body {
    margin: 0;
    background: #111;
    color: #fff;
    font-family: sans-serif;
  }

  .bracket-container {
    width: 100%;
    height: 100vh;
    overflow: auto;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 20px;
  }

  .bracket-tree {
    display: grid;
    grid-template-columns: repeat(4, 220px);
    gap: 50px;
  }

  .round {
    display: flex;
    flex-direction: column;
    gap: 25px;
  }

  .match {
    background: #222;
    border: 1px solid #444;
    border-radius: 8px;
    padding: 6px 10px;
    min-width: 200px;
  }

  .player {
    display: flex;
    justify-content: space-between;
    padding: 4px;
  }

  .player span {
    flex: 1;
  }

  .score {
    width: 28px;
    text-align: center;
    background: transparent;
    border: none;
    color: #fff;
  }
</style>
</head>
<body>
  <div class="bracket-container">
    <div class="bracket-tree" id="visualBracket">
      <!-- Winners Side -->
      <div class="round">
        <h3>Winners Semis</h3>
        <div class="match">
          <div class="player"><span id="wb_sf1_p1">—</span><input id="wb_sf1_s1" class="score" readonly></div>
          <div class="player"><span id="wb_sf1_p2">—</span><input id="wb_sf1_s2" class="score" readonly></div>
        </div>
        <div class="match">
          <div class="player"><span id="wb_sf2_p1">—</span><input id="wb_sf2_s1" class="score" readonly></div>
          <div class="player"><span id="wb_sf2_p2">—</span><input id="wb_sf2_s2" class="score" readonly></div>
        </div>
        <h3>Winners Final</h3>
        <div class="match">
          <div class="player"><span id="wb_final_p1">—</span><input id="wb_final_s1" class="score" readonly></div>
          <div class="player"><span id="wb_final_p2">—</span><input id="wb_final_s2" class="score" readonly></div>
        </div>
      </div>

      <!-- Losers R1 -->
      <div class="round">
        <h3>Losers R1</h3>
        <div class="match">
          <div class="player"><span id="lb_r1_m1_p1">—</span><input id="lb_r1_m1_s1" class="score" readonly></div>
          <div class="player"><span id="lb_r1_m1_p2">—</span><input id="lb_r1_m1_s2" class="score" readonly></div>
        </div>
        <div class="match">
          <div class="player"><span id="lb_r1_m2_p1">—</span><input id="lb_r1_m2_s1" class="score" readonly></div>
          <div class="player"><span id="lb_r1_m2_p2">—</span><input id="lb_r1_m2_s2" class="score" readonly></div>
        </div>

        <h3>Losers R2</h3>
        <div class="match">
          <div class="player"><span id="lb_r2_m1_p1">—</span><input id="lb_r2_m1_s1" class="score" readonly></div>
          <div class="player"><span id="lb_r2_m1_p2">—</span><input id="lb_r2_m1_s2" class="score" readonly></div>
        </div>
        <div class="match">
          <div class="player"><span id="lb_r2_m2_p1">—</span><input id="lb_r2_m2_s1" class="score" readonly></div>
          <div class="player"><span id="lb_r2_m2_p2">—</span><input id="lb_r2_m2_s2" class="score" readonly></div>
        </div>
      </div>

      <!-- Losers Final -->
      <div class="round">
        <h3>Losers Final</h3>
        <div class="match">
          <div class="player"><span id="lb_final_p1">—</span><input id="lb_final_s1" class="score" readonly></div>
          <div class="player"><span id="lb_final_p2">—</span><input id="lb_final_s2" class="score" readonly></div>
        </div>
      </div>

      <!-- Grand Final -->
      <div class="round">
        <h3>Grand Final</h3>
        <div class="match">
          <div class="player"><span id="gf_wb">—</span><input id="gf_wb_s" class="score" readonly></div>
          <div class="player"><span id="gf_lb">—</span><input id="gf_lb_s" class="score" readonly></div>
        </div>

        <h3>Grand Final Reset</h3>
        <div class="match">
          <div class="player"><span id="gf_reset_p1">—</span><input id="gf_reset_s1" class="score" readonly></div>
          <div class="player"><span id="gf_reset_p2">—</span><input id="gf_reset_s2" class="score" readonly></div>
        </div>
      </div>
    </div>
  </div>

<script>
let bracketData = null;

function ensureBracket(){
  if(!bracketData){
    bracketData = { double: { players: Array(8).fill(""), scores: {}, winners: {} } };
  }
}

async function loadBracket(){
  ensureBracket();
  try {
    const resp = await fetch("bracket.json?_=" + Date.now());
    if(!resp.ok) throw new Error("no bracket.json");
    bracketData = await resp.json();
  } catch (err) {
    console.warn("No bracket.json found – using blank bracket");
  }
  renderDoubleFromData();
}

function renderDoubleFromData(){
  ensureBracket();
  const d = bracketData.double || { players: Array(8).fill(""), scores:{}, winners:{}, losers:{} };

  // === Players mapping from index.html seeding ===
  // Winners seeds (dp1..dp4)
  document.getElementById("wb_sf1_p1").textContent = d.players[0] || "Seed 1";
  document.getElementById("wb_sf1_p2").textContent = d.players[1] || "Seed 2";
  document.getElementById("wb_sf2_p1").textContent = d.players[2] || "Seed 3";
  document.getElementById("wb_sf2_p2").textContent = d.players[3] || "Seed 4";

  // Losers seeds (dp5..dp8)
  document.getElementById("lb_r1_m1_p1").textContent = d.players[4] || "Seed 5";
  document.getElementById("lb_r1_m1_p2").textContent = d.players[5] || "Seed 6";
  document.getElementById("lb_r1_m2_p1").textContent = d.players[6] || "Seed 7";
  document.getElementById("lb_r1_m2_p2").textContent = d.players[7] || "Seed 8";

  // Winners filled downstream
  document.getElementById("wb_final_p1").textContent = d.winners?.wb_sf1 || "Winner SF1";
  document.getElementById("wb_final_p2").textContent = d.winners?.wb_sf2 || "Winner SF2";

  // Losers R2 from R1 winners & SF losers
  document.getElementById("lb_r2_m1_p1").textContent = d.winners?.lb_r1_m1 || "Winner R1M1";
  document.getElementById("lb_r2_m1_p2").textContent = d.losers?.wb_sf1 || "Loser SF1";

  document.getElementById("lb_r2_m2_p1").textContent = d.winners?.lb_r1_m2 || "Winner R1M2";
  document.getElementById("lb_r2_m2_p2").textContent = d.losers?.wb_sf2 || "Loser SF2";

  // Losers final
  document.getElementById("lb_final_p1").textContent = d.winners?.lb_r2_m1 || "Winner R2M1";
  document.getElementById("lb_final_p2").textContent = d.winners?.lb_r2_m2 || "Winner R2M2";

  // Grand Final
  document.getElementById("gf_wb").textContent = d.winners?.wb_final || "WB Winner";
  document.getElementById("gf_lb").textContent = d.winners?.lb_final || "LB Winner";

  // Reset GF
  document.getElementById("gf_reset_p1").textContent = d.winners?.wb_final || "Player A";
  document.getElementById("gf_reset_p2").textContent = d.winners?.lb_final || "Player B";

  // === Scores ===
  function setPair(mid){
    const sc = d.scores[mid] || [null,null];
    if(document.getElementById(mid+"_s1")) document.getElementById(mid+"_s1").value = sc[0] ?? "";
    if(document.getElementById(mid+"_s2")) document.getElementById(mid+"_s2").value = sc[1] ?? "";
  }
  ["wb_sf1","wb_sf2","wb_final","lb_r1_m1","lb_r1_m2","lb_r2_m1","lb_r2_m2","lb_final"].forEach(setPair);

  if(d.scores.grand_final){
    document.getElementById("gf_wb_s").value = d.scores.grand_final[0] ?? "";
    document.getElementById("gf_lb_s").value = d.scores.grand_final[1] ?? "";
  }
  if(d.scores.gf_reset){
    document.getElementById("gf_reset_s1").value = d.scores.gf_reset[0] ?? "";
    document.getElementById("gf_reset_s2").value = d.scores.gf_reset[1] ?? "";
  }
}

// Winners Semis
let sc = d.scores?.wb_sf1 || [null,null];
document.getElementById("wb_sf1_s1").value = sc[0] ?? "";
document.getElementById("wb_sf1_s2").value = sc[1] ?? "";

sc = d.scores?.wb_sf2 || [null,null];
document.getElementById("wb_sf2_s1").value = sc[0] ?? "";
document.getElementById("wb_sf2_s2").value = sc[1] ?? "";

// Winners Final
sc = d.scores?.wb_final || [null,null];
document.getElementById("wb_final_s1").value = sc[0] ?? "";
document.getElementById("wb_final_s2").value = sc[1] ?? "";

// Losers R1
sc = d.scores?.lb_r1_m1 || [null,null];
document.getElementById("lb_r1_m1_s1").value = sc[0] ?? "";
document.getElementById("lb_r1_m1_s2").value = sc[1] ?? "";

sc = d.scores?.lb_r1_m2 || [null,null];
document.getElementById("lb_r1_m2_s1").value = sc[0] ?? "";
document.getElementById("lb_r1_m2_s2").value = sc[1] ?? "";

// …repeat for lb_r2_m1, lb_r2_m2, lb_final, gf_wb/gf_lb, gf_reset


// Auto load on page open
window.addEventListener("DOMContentLoaded", () => {
  loadBracket();
  setInterval(loadBracket, 1000);
});
</script>
</body>
</html>
