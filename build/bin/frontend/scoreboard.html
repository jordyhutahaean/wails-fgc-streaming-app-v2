<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Scoreboard</title>
  <link rel="stylesheet" href="scoreboard.css">
</head>
<body>

  <div id="titlecard" class="titlecard">
  </div>

  <div id="p1-card" class="player">
    <div class="score" id="s1">0</div>
    <div class="player-info">
      <div class="score-text">
        <div class="name">Player 1</div>
        <div class="team"> </div>
      </div>
      <div class="nation-container" id="n1">
        <span class="nation"></span>
      </div>
    </div>
  </div>

  <div id="p2-card" class="player">
    <div class="score" id="s2">0</div>
    <div class="player-info">
      <div class="score-text">
        <div class="name">Player 2</div>
        <div class="team"> </div>
      </div>
      <div class="nation-container" id="n2"> 
        <span class="nation"></span>
      </div>
    </div>
  </div>

  <div id="p3-card" class="player" style="display:none;">
    <div class="score" id="s3" style="display: none;">0</div>
    <div class="player-info">
      <div class="score-text">
        <div class="name">Player 3</div>
        <div class="team"> </div>
      </div>
      <div class="nation-container" id="n3"> 
        <span class="nation"></span>
      </div>
    </div>
  </div>

  <div id="p4-card" class="player" style="display:none;">
    <div class="score" id="s4" style="display: none;">0</div>
    <div class="player-info">
      <div class="score-text">
        <div class="name">Player 4</div>
        <div class="team"> </div>
      </div>
      <div class="nation-container" id="n4"> 
        <span class="nation"></span>
      </div>
    </div>
  </div>

  <!-- Sponsor Section -->
   <!-- add more image by following the pattern below -->
    <!-- Add => <img src="[YOUT IMAGE PATHFILE]" class="sponsor-logo">  -->

<div id="sponsor-container">
<!--   
  <img src="sponsors/sponsor1.png" class="sponsor-logo">
  <img src="sponsors/aaa.png" class="sponsor-logo">
  <img src="sponsors/Group 5.png" class="sponsor-logo"> -->
</div>

 

<script>
async function loadScoreboard() {
  try {
    const resp = await fetch("scoreboard.json?_=" + Date.now());
    if (!resp.ok) throw new Error("Failed to fetch scoreboard.json");
    const data = await resp.json();

    const gameClassMap = { sf: "sf", dbfz: "dbfz", tekken: "tekken", "2xko": "_2XKO",   gbvsr: "gbvsr",  };

    // reset all classes
    document.body.classList.remove("sf","dbfz","tekken","_2XKO","gbvsr","minimalist","arcade","futuristic","white_outline");

    // apply game + style
    if (gameClassMap[data.game]) document.body.classList.add(gameClassMap[data.game]);
    if (data.style) document.body.classList.add(data.style);

    // update titlecard
    const titleEl = document.getElementById("titlecard");
    if (titleEl) titleEl.textContent = data.titlecard || "";

    // players
    ["p1","p2","p3","p4"].forEach((p,i) => {
      const idx = i + 1;
      const card = document.getElementById(`p${idx}-card`);
      if (!card) return;

      const visible = (i < 2) ? true : !!data[`visible${idx}`];
      card.style.display = visible ? "flex" : "none";

      const nameEl = card.querySelector(".name");
      const teamEl = card.querySelector(".team");
      const scoreEl = card.querySelector(".score");
      const nationEl = card.querySelector(".nation-container") || document.getElementById(`n${idx}`);

      if (nameEl) nameEl.textContent = data[`player${idx}`] || `Player ${idx}`;
      if (teamEl) teamEl.textContent = data[`team${idx}`] || "";
      if (scoreEl) scoreEl.textContent = (data[`score${idx}`] ?? 0);

      // set nation / country id (from scoreboard JSON field controller1..4)
      if (nationEl) nationEl.textContent = (data[`nation${idx}`] || "").toUpperCase();

      // safe controller image block (only if element exists)
      const containerEl = card.querySelector(".controller-container");
      if (containerEl) {
        const controllerEl = containerEl.querySelector(".controller");
        const controllerType = data[`nation${idx}`];
        if (controllerType && controllerType !== "none" && controllerEl) {
          containerEl.style.display = "block";
          controllerEl.src = `img/controller/1x/${controllerType}.png`;
        } else {
          containerEl.style.display = "none";
        }
      }
    });

    // ✅ Now check duo AFTER loop
    const p1Visible = document.getElementById("p1-card").style.display !== "none";
    const p2Visible = document.getElementById("p2-card").style.display !== "none";
    const p3Visible = document.getElementById("p3-card").style.display !== "none";
    const p4Visible = document.getElementById("p4-card").style.display !== "none";

    // Clear helper classes first
    document.body.classList.remove("has-left-duo","has-right-duo");

    // Add helper if P1+P3 are both visible
    if (p1Visible && p3Visible) {
      document.body.classList.add("has-left-duo");
    }

    // Add helper if P2+P4 are both visible
    if (p2Visible && p4Visible) {
      document.body.classList.add("has-right-duo");
    }

    // ✅ Call auto-fit AFTER data loads
    applyNameAutoFit();
    applyTeamAutoFit();
    applyTitleAutoFit();

  } catch (err) {
    console.error("Error loading scoreboard.json:", err);
  }
}

// Remove the separate setInterval calls or keep them as backup:
setInterval(() => {
  applyTeamAutoFit();
  applyNameAutoFit();
  applyTitleAutoFit();
}, 1000); // Match the loadScoreboard interval

// Main load
setInterval(loadScoreboard, 1000);
loadScoreboard();
</script>

<script>
function autoFitName(element, baseSize, minSize) {
  const parentWidth = element.parentElement.offsetWidth;

  element.style.fontSize = baseSize + "px";

  while (element.scrollWidth > parentWidth && baseSize > minSize) {
    baseSize--;
    element.style.fontSize = baseSize + "px";
  }
}

// function applyNameAutoFit() {
//   document.querySelectorAll(".name").forEach(name => {
//     const style = window.getComputedStyle(name);
//     const baseSize = parseInt(style.fontSize) || 22;

//     // different themes can change min font size
//     const minSize =
//       document.body.classList.contains("minimalist")
//         ? 16
//       : document.body.classList.contains("white_outline")
//         ? 14
//       : 18; // default fallback

//     autoFitName(name, baseSize, minSize);
//   });
// }

function applyNameAutoFit() {
  document.querySelectorAll(".name").forEach(name => {
    const style = window.getComputedStyle(name);
    const baseSize = parseInt(style.fontSize) || 22;

    const nameFontRules = {
      minimalist: 16,
      arcade: 18,
      futuristic: 18,
      white_outline: 14,
      gb_versus:18
    };

    let minSize = nameFontRules.default;

    for (const key in nameFontRules) {
      if (document.body.classList.contains(key)) {
        minSize = nameFontRules[key];
        break;
      }
    }

    autoFitName(name, baseSize, minSize);
  });
}
 
 
setInterval(applyNameAutoFit, 300);
</script>

 

<script>

async function loadSponsors() {
  try {
    // ✅ Since scoreboard.html is in frontend/, and sponsors.json is also in frontend/
    const resp = await fetch("sponsors.json?_=" + Date.now());
    if (!resp.ok) throw new Error("Failed to fetch sponsors.json");
    const sponsors = await resp.json();

    const cont = document.getElementById("sponsor-container");
    cont.innerHTML = "";

    sponsors.forEach((src, i) => {
      const img = document.createElement("img");
      img.src = src; // "sponsors/jabo.png"
      img.className = "sponsor-logo";
      img.style.opacity = i === 0 ? "1" : "0";
      img.style.transition = "opacity 1s";
      cont.appendChild(img);
    });

    startSponsorRotation();
  } catch (e) {
    console.error("Sponsor load failed:", e);
  }
}


function startSponsorRotation(){
  const images = Array.from(document.querySelectorAll('#sponsor-container .sponsor-logo'));
  if(images.length <= 1) return;
  let current=0;
  setInterval(()=>{
    images[current].style.opacity="0";
    current=(current+1)%images.length;
    images[current].style.opacity="1";
  },10000);
}

 
document.addEventListener("DOMContentLoaded", loadSponsors);


</script>

</body>
</html>
