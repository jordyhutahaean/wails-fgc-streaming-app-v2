<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Double Bracket Overlay</title>
<style>
 body {
  margin: 0;
 
  color: #fff;
  font-family: 'Bahnschrift', sans-serif;
}

.bracket-container {
  width: 100%;
  height: 100vh;
  overflow: auto;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding: 20px;

  background: rgba(0, 0, 0, 0.925)
}

.bracket-tree {
  position: absolute;
  bottom: 30%;
}

.bracket-tree .win {
  display: grid;
  gap: 385px;
  align-items: center;
  grid-template-columns: repeat(3, 320px);
}

.bracket-tree .los {
  display: grid;
  gap: 150px;
  align-items: center;
  grid-template-columns: repeat(4, 320px);
}

.round {
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.round h3 {
  font-size: 14px;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: #1ea7ff;
  margin: 8px 0;
  text-align: center;
}

.match {
  background: rgba(20, 20, 30, 0.7);
  border: 1px solid rgba(30,167,255,0.6);
  border-radius: 10px;
  padding: 8px 12px;
  min-width: 180px;
  box-shadow: 0 0 12px rgba(0,0,0,0.6);
  backdrop-filter: blur(6px);
  transition: all 0.2s ease;
}
.match:hover {
  transform: scale(1.02);
  border-color: #1ea7ff;
  box-shadow: 0 0 18px rgba(30,167,255,0.8);
}

.player {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 4px;
  border-radius: 6px;
  margin: 2px 0;
  transition: background 0.3s ease;
}
.player span {
  flex: 1;
  font-weight: 600;
}
.player.empty span {
  color: #666;
  font-weight: normal;
}

.player.win {
  background: rgba(0,200,100,0.25);
}
.player.lose {
  background: rgba(200,0,50,0.25);
}

.score {
  width: 32px;
  text-align: center;
  border: none;
  border-radius: 4px;
  background: rgba(255,255,255,0.15);
  color: #fff;
  font-weight: bold;
}

.player.win { background: rgba(255,255,255,0.15); }
.player.lose { background: transparent; opacity: 0.6; }

.vid-cont{
    background: rgba(7, 7, 6, 0.233);
}
.background-vid{
    width: 100vw;
    height: auto;
    object-fit: cover;
    position:absolute;
    filter:blur(18px) brightness(0.4);
}


.title {
  position: absolute;
  left: 4%;
  top: 2%;

  display: block;
 
  gap: 06px;
}

.title h1 {
  margin-top: 30px;
  font-size: 32px;
  color: #fff;
  text-shadow: 0 0 8px rgba(30,167,255,0.7);
}

.title h2 {
 
  font-size: 40px;
  color: #1ea7ff;
  text-shadow: 0 0 6px rgba(0,0,0,0.5);
}
</style>
</head>
<body>
   <div class="title">
    <h1 id="top8">TOP 8</h1>
    <h2 id="game-title">Tekken 8</h1>
  </div>
  <div class="bracket-container">
    <div class="bracket-tree" id="visualBracket">
      <div class="win">
        <!-- Winners Side -->
        <div class="round" style="gap: 20px;">
          <h3>Winners Semis</h3>
          <div class="match">
            <div class="player"><span id="wb_sf1_p1">—</span><input id="wb_sf1_s1" class="score" readonly></div>
            <div class="player"><span id="wb_sf1_p2">—</span><input id="wb_sf1_s2" class="score" readonly></div>
          </div>
          <div class="match">
            <div class="player"><span id="wb_sf2_p1">—</span><input id="wb_sf2_s1" class="score" readonly></div>
            <div class="player"><span id="wb_sf2_p2">—</span><input id="wb_sf2_s2" class="score" readonly></div>
          </div>
        </div>
        <div class="round">
          <h3>Winners Final</h3>
          <div class="match">
            <div class="player"><span id="wb_final_p1">—</span><input id="wb_final_s1" class="score" readonly></div>
            <div class="player"><span id="wb_final_p2">—</span><input id="wb_final_s2" class="score" readonly></div>
          </div>
        </div>
        <div class="finals-bracket">
          <div class="round">
            <h3>Grand Final</h3>
            <div class="match">
              <div class="player"><span id="gf_wb">—</span><input id="gf_wb_s" class="score" readonly></div>
              <div class="player"><span id="gf_lb">—</span><input id="gf_lb_s" class="score" readonly></div>
            </div>

            <h3>Grand Final Reset</h3>
            <div class="match">
              <div class="player"><span id="gf_reset_p1">—</span><input id="gf_reset_s1" class="score" readonly></div>
              <div class="player"><span id="gf_reset_p2">—</span><input id="gf_reset_s2" class="score" readonly></div>
            </div>
          </div>
        </div>
      </div>

      <div class="los">
        <!-- Losers R1 -->
        <div class="round" style="gap: 30px;">
          <h3>Losers Round 1</h3>
          <div class="match">
            <div class="player"><span id="lb_r1_m1_p1">—</span><input id="lb_r1_m1_s1" class="score" readonly></div>
            <div class="player"><span id="lb_r1_m1_p2">—</span><input id="lb_r1_m1_s2" class="score" readonly></div>
          </div>
          <div class="match">
            <div class="player"><span id="lb_r1_m2_p1">—</span><input id="lb_r1_m2_s1" class="score" readonly></div>
            <div class="player"><span id="lb_r1_m2_p2">—</span><input id="lb_r1_m2_s2" class="score" readonly></div>
          </div>
        </div>
        <!-- Losers Quarterfinals -->
        <div class="round" style="gap: 30px;">
          <h3>Losers Quarterfinals</h3>
          <div class="match">
            <div class="player"><span id="lb_qf_m1_p1">—</span><input id="lb_qf_m1_s1" class="score" readonly></div>
            <div class="player"><span id="lb_qf_m1_p2">—</span><input id="lb_qf_m1_s2" class="score" readonly></div>
          </div>
          <div class="match">
            <div class="player"><span id="lb_qf_m2_p1">—</span><input id="lb_qf_m2_s1" class="score" readonly></div>
            <div class="player"><span id="lb_qf_m2_p2">—</span><input id="lb_qf_m2_s2" class="score" readonly></div>
          </div>
        </div>
        <!-- Losers Semis -->
        <div class="round" style="gap: 30px;">
          <h3>Losers Semifinal</h3>
          <div class="match">
            <div class="player"><span id="lb_semi_p1">—</span><input id="lb_semi_s1" class="score" readonly></div>
            <div class="player"><span id="lb_semi_p2">—</span><input id="lb_semi_s2" class="score" readonly></div>
          </div>
        </div>
        <!-- Losers Final -->
        <div class="round" style="gap: 30px;">
          <h3>Losers Final</h3>
          <div class="match">
            <div class="player"><span id="lb_final_p1">—</span><input id="lb_final_s1" class="score" readonly></div>
            <div class="player"><span id="lb_final_p2">—</span><input id="lb_final_s2" class="score" readonly></div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
// ===== Bracket Core =====
let bracketData = null;
function ensureBracket(){
  if(!bracketData){
    bracketData = { double: { players: Array(8).fill(""), scores: {}, winners: {}, losers: {} } };
  }
}

// Copy your full updateDoubleBracket() function here from index.html
// (unchanged, it computes winners/losers from scores)
function updateDoubleBracket(){
  ensureBracket();
  const d = bracketData.double;
  d.scores = d.scores || {};
  d.winners = d.winners || {};
  d.losers = d.losers || {};

  // helper to store scores
  function store(mid){
    const s1 = parseInt(document.getElementById(mid+"_s1")?.value)||0;
    const s2 = parseInt(document.getElementById(mid+"_s2")?.value)||0;
    d.scores[mid] = [s1,s2];
    if(s1===s2) return {winner:null,loser:null};
    if(s1>s2){
      return {winner: document.getElementById(mid+"_p1").textContent, loser: document.getElementById(mid+"_p2").textContent};
    }else{
      return {winner: document.getElementById(mid+"_p2").textContent, loser: document.getElementById(mid+"_p1").textContent};
    }
  }

  // === Winners Side ===
  let m = store("wb_sf1");
  if(m.winner){ d.winners.wb_sf1=m.winner; d.losers.wb_sf1=m.loser; }
  m = store("wb_sf2");
  if(m.winner){ d.winners.wb_sf2=m.winner; d.losers.wb_sf2=m.loser; }

  m = store("wb_final");
  if(m.winner){ d.winners.wb_final=m.winner; d.losers.wb_final=m.loser; }

  // === Losers R1 ===
  m = store("lb_r1_m1");
  if(m.winner) d.winners.lb_r1_m1=m.winner;
  m = store("lb_r1_m2");
  if(m.winner) d.winners.lb_r1_m2=m.winner;

  // === Losers QF ===
  m = store("lb_qf_m1");
  if(m.winner) d.winners.lb_qf_m1=m.winner;
  m = store("lb_qf_m2");
  if(m.winner) d.winners.lb_qf_m2=m.winner;

  // === Losers Semi ===
  m = store("lb_semi");
  if(m.winner) d.winners.lb_semi=m.winner;

  // === Losers Final ===
  m = store("lb_final");
  if(m.winner) d.winners.lb_final=m.winner;

  // === Grand Final ===
  const gf1 = parseInt(document.getElementById("gf_wb_s")?.value)||0;
  const gf2 = parseInt(document.getElementById("gf_lb_s")?.value)||0;
  d.scores.grand_final = [gf1,gf2];
  if(gf1!==gf2){
    d.winners.grand_final = gf1>gf2 ? document.getElementById("gf_wb").textContent : document.getElementById("gf_lb").textContent;
  }

  const r1 = parseInt(document.getElementById("gf_reset_s1")?.value)||0;
  const r2 = parseInt(document.getElementById("gf_reset_s2")?.value)||0;
  d.scores.gf_reset = [r1,r2];
  if(r1!==r2){
    d.winners.gf_reset = r1>r2 ? document.getElementById("gf_reset_p1").textContent : document.getElementById("gf_reset_p2").textContent;
  }
}
// ===== Overlay Rendering =====
function renderDoubleFromData(){
  ensureBracket();
  const d = bracketData.double || {};
  const set = (id, val) => {
    const el=document.getElementById(id);
    if(el) el.textContent=val;
  };

  // Winners Semis / Final
  set("wb_sf1_p1", d.winners?.wb_qf1 || "Winner QF1");
  set("wb_sf1_p2", d.winners?.wb_qf2 || "Winner QF2");
  set("wb_sf2_p1", d.winners?.wb_qf3 || "Winner QF3");
  set("wb_sf2_p2", d.winners?.wb_qf4 || "Winner QF4");
  set("wb_final_p1", d.winners?.wb_sf1 || "Winner SF1");
  set("wb_final_p2", d.winners?.wb_sf2 || "Winner SF2");

  // Losers Round 1
  set("lb_r1_m1_p1", d.losers?.wb_qf1 || "Loser QF1");
  set("lb_r1_m1_p2", d.losers?.wb_qf2 || "Loser QF2");
  set("lb_r1_m2_p1", d.losers?.wb_qf3 || "Loser QF3");
  set("lb_r1_m2_p2", d.losers?.wb_qf4 || "Loser QF4");

  // Losers QF
  set("lb_qf_m1_p1", d.winners?.lb_r1_m1 || "Winner R1M1");
  set("lb_qf_m1_p2", d.losers?.wb_sf1 || "Loser SF1");
  set("lb_qf_m2_p1", d.winners?.lb_r1_m2 || "Winner R1M2");
  set("lb_qf_m2_p2", d.losers?.wb_sf2 || "Loser SF2");

  // Losers Semi
  set("lb_semi_p1", d.winners?.lb_qf_m1 || "Winner QF1");
  set("lb_semi_p2", d.winners?.lb_qf_m2 || "Winner QF2");

  // Losers Final
  set("lb_final_p1", d.winners?.lb_semi || "Winner LB Semi");
  set("lb_final_p2", d.losers?.wb_final || "Loser WB Final");

  // Grand Final
  set("gf_wb", d.winners?.wb_final || "WB Winner");
  set("gf_lb", d.winners?.lb_final || "LB Winner");

  // Reset (if needed)
  if(d.scores?.grand_final){
    const [a,b]=d.scores.grand_final;
    if(a!==null&&b!==null&&a!==b && b>a){
      document.getElementById("gf_reset").style.display="block";
      set("gf_reset_p1", d.winners?.wb_final || "WB Champ");
      set("gf_reset_p2", d.winners?.lb_final || "LB Champ");
    } else {
      document.getElementById("gf_reset").style.display="none";
    }
  }
}

// ===== Load JSON and refresh =====
async function loadOverlayDouble(){
  try{
    const resp = await fetch("bracket.json?_=" + Date.now());
    if(!resp.ok) throw new Error("No bracket.json found");
    const data = await resp.json();
    if(!data.double || !Array.isArray(data.double.players)) return;
    bracketData = data;
    updateDoubleBracket();   // compute winners & losers
    renderOverlay();         // draw to HTML
  }catch(err){
    console.warn("Overlay double load failed:", err);
  }
}

document.addEventListener("DOMContentLoaded", () => {
  loadOverlayDouble();
  setInterval(loadOverlayDouble, 2000); // refresh every 2s
});

// Fetch latest bracket.json and re-render overlay
// Robust fetch + render for overlay
async function fetchBracket(){
  try {
    const res = await fetch("bracket.json?cachebust=" + Date.now(), { cache: 'no-store' });
    if(!res.ok){
      console.warn("fetchBracket: bracket.json not found", res.status);
      return;
    }
    const data = await res.json();
    // Accept two shapes:
    // 1) full object { single:..., double: {...} } OR
    // 2) direct double object { players:[], winners:{}, losers:{} }
    if(data.double) {
      bracketData = data;
    } else if (data.players || data.winners || data.losers) {
      // older format: file contains only the double object
      bracketData = { double: data };
    } else {
      console.warn("fetchBracket: unknown JSON shape", data);
      bracketData = { double: { players: Array(8).fill(""), scores:{}, winners:{}, losers:{} } };
    }
    console.log("fetchBracket: received", bracketData.double);
    renderDoubleFromData();
  } catch (e) {
    console.warn("fetchBracket error:", e);
  }
}

function setTextOrValue(id, val){
  const el = document.getElementById(id);
  if(!el) return;
  if(el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') el.value = val ?? '';
  else el.textContent = val ?? '';
}

// full render (uses players[] fallback and reads d.losers where appropriate)
function renderDoubleFromData(){
  ensureBracket();
  const d = (bracketData && bracketData.double) ? bracketData.double : { players: Array(8).fill(""), scores:{}, winners:{}, losers:{} };
  // short alias
  const p = d.players || [];

  // Winners Semis (seeds 0..3)
  setTextOrValue("wb_sf1_p1", d.winners?.wb_qf1 || p[0] || "Winner QF1");
  setTextOrValue("wb_sf1_p2", d.winners?.wb_qf2 || p[1] || "Winner QF2");
  setTextOrValue("wb_sf2_p1", d.winners?.wb_qf3 || p[2] || "Winner QF3");
  setTextOrValue("wb_sf2_p2", d.winners?.wb_qf4 || p[3] || "Winner QF4");

  // Winners Final
  setTextOrValue("wb_final_p1", d.winners?.wb_sf1 || "Winner SF1");
  setTextOrValue("wb_final_p2", d.winners?.wb_sf2 || "Winner SF2");

  // Losers R1 seeded (seeds 4..7)
  setTextOrValue("lb_r1_m1_p1", p[4] || "Loser QF1");
  setTextOrValue("lb_r1_m1_p2", p[5] || "Loser QF2");
  setTextOrValue("lb_r1_m2_p1", p[6] || "Loser QF3");
  setTextOrValue("lb_r1_m2_p2", p[7] || "Loser QF4");

  // LB QF (R1 winners + WB SF losers)
  setTextOrValue("lb_qf_m1_p1", d.winners?.lb_r1_m1 || "Winner R1M1");
  setTextOrValue("lb_qf_m1_p2", d.losers?.wb_sf1   || "Loser SF1");
  setTextOrValue("lb_qf_m2_p1", d.winners?.lb_r1_m2 || "Winner R1M2");
  setTextOrValue("lb_qf_m2_p2", d.losers?.wb_sf2   || "Loser SF2");

  // LB Semi
  setTextOrValue("lb_semi_p1", d.winners?.lb_qf_m1 || "Winner QF1");
  setTextOrValue("lb_semi_p2", d.winners?.lb_qf_m2 || "Winner QF2");

  // LB Final
  setTextOrValue("lb_final_p1", d.winners?.lb_semi || "Winner LB Semi");
  setTextOrValue("lb_final_p2", d.losers?.wb_final || "Loser WB Final");

  // GF
  setTextOrValue("gf_wb", d.winners?.wb_final || "WB Winner");
  setTextOrValue("gf_lb", d.winners?.lb_final || "LB Winner");

  // scores (optional: update number inputs)
  const setScore = (matchId) => {
    const sc = d.scores?.[matchId];
    if(Array.isArray(sc) && sc.length>=2){
      const aEl = document.getElementById(matchId + "_s1");
      const bEl = document.getElementById(matchId + "_s2");
      if(aEl) aEl.value = sc[0] ?? "";
      if(bEl) bEl.value = sc[1] ?? "";
    }
  };
  ["wb_sf1","wb_sf2","wb_final","lb_r1_m1","lb_r1_m2","lb_qf_m1","lb_qf_m2","lb_semi","lb_final"].forEach(setScore);

  // show/hide gf_reset if needed
  if(d.scores?.grand_final){
    const [a,b] = d.scores.grand_final;
    if(a!==null && b!==null && a!==b && b > a){
      const el = document.getElementById("gf_reset");
      if(el) el.style.display = "block";
    } else {
      const el = document.getElementById("gf_reset");
      if(el) el.style.display = "none";
    }
  }
}

// auto-refresh loop
let _fetchTimer = null;
function startOverlayAutoRefresh(){
  if(_fetchTimer) clearInterval(_fetchTimer);
  fetchBracket();          // immediate
  _fetchTimer = setInterval(fetchBracket, 1000); // every 1s
}
startOverlayAutoRefresh();


// Auto-refresh every 1 second
setInterval(fetchBracket, 1000);

// Run once on load
fetchBracket();


</script>
</body>
</html>
